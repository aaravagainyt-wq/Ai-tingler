<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FAZE | NEURAL TERMINAL v7.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&display=swap');
        
        :root {
            --primary: #00ff41;
            --danger: #ff003c;
            --bg: #050505;
        }

        body { 
            background: var(--bg); 
            color: #fff; 
            font-family: 'JetBrains Mono', monospace; 
            overflow: hidden; 
            height: 100vh;
        }

        /* --- UI COMPONENTS --- */
        .crt-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%; z-index: 50; pointer-events: none;
        }

        canvas#matrix { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.15; }

        .faze-panel {
            background: rgba(10, 10, 10, 0.85);
            border: 1px solid #222;
            backdrop-filter: blur(10px);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }

        /* --- ANIMATIONS --- */
        @keyframes scan { from { top: -100%; } to { top: 100%; } }
        .scanner {
            position: absolute; width: 100%; height: 5px;
            background: var(--primary); opacity: 0.2;
            box-shadow: 0 0 20px var(--primary);
            animation: scan 4s linear infinite;
        }

        .glitch-text:hover {
            animation: glitch 0.3s cubic-bezier(.25,.46,.45,.94) both infinite;
        }

        @keyframes glitch {
            0% { transform: translate(0) }
            20% { transform: translate(-2px, 2px) }
            40% { transform: translate(-2px, -2px) }
            60% { transform: translate(2px, 2px) }
            80% { transform: translate(2px, -2px) }
            100% { transform: translate(0) }
        }

        .border-scientist { border-left: 4px solid #3b82f6; box-shadow: -10px 0 20px -10px rgba(59, 130, 246, 0.3); }
        .border-safety { border-left: 4px solid #22c55e; box-shadow: -10px 0 20px -10px rgba(34, 197, 94, 0.3); }
        .border-logic { border-left: 4px solid #a855f7; box-shadow: -10px 0 20px -10px rgba(168, 85, 247, 0.3); }
    </style>
</head>
<body class="flex flex-col">

    <div class="crt-overlay"></div>
    <canvas id="matrix"></canvas>

    <div id="tos-gateway" class="fixed inset-0 z-[100] bg-black flex items-center justify-center p-6">
        <div class="faze-panel max-w-lg w-full p-10 border-red-900 border-2 shadow-[0_0_50px_rgba(153,0,0,0.2)]">
            <h2 class="text-3xl font-black text-red-600 mb-2 italic glitch-text">SAFETY CLEARANCE REQ</h2>
            <p class="text-[10px] text-zinc-500 mb-8 tracking-[0.2em]">FAZE NEURAL INTERFACE // RESTRICTED ACCESS</p>
            
            <div class="bg-black/50 p-4 border border-zinc-800 h-64 overflow-y-auto mb-8 text-[11px] text-zinc-400 leading-relaxed space-y-4 font-sans">
                <p class="text-white font-bold underline">SECTION 1: NON-HARM PROTOCOL</p>
                <p>User agrees never to prompt the AI for illegal acts, violence, weapons manufacturing, or harmful biotechnology research.</p>
                
                <p class="text-white font-bold underline">SECTION 2: LIABILITY WAIVER</p>
                <p>Output is generated by a 3B parameter model. Developer (Sarav) is not responsible for hallucinations or incorrect scientific data.</p>
                
                <p class="text-white font-bold underline">SECTION 3: SYSTEM LIMITS</p>
                <p>Connections use a free CPU tier. Latency is expected. Neural drops are handled via auto-retry protocols.</p>
            </div>

            <button onclick="unlockSystem()" class="w-full bg-red-600 py-4 font-black text-xs hover:bg-white hover:text-black transition-all tracking-[0.4em]">I ACCEPT TERMS</button>
        </div>
    </div>

    <div id="terminal-ui" class="hidden h-full flex flex-col p-4 gap-4">
        
        <div class="faze-panel p-4 flex justify-between items-center text-[10px] border-zinc-800">
            <div class="flex gap-6 items-center">
                <span class="font-black text-blue-500">FAZE CORE v7.0</span>
                <div class="flex flex-col">
                    <span class="text-zinc-600">RAM USAGE</span>
                    <div class="w-24 h-1 bg-zinc-900 mt-1"><div id="ram-bar" class="h-full bg-blue-500 w-[12%] transition-all duration-1000"></div></div>
                </div>
                <div class="flex flex-col">
                    <span class="text-zinc-600">CPU LOAD</span>
                    <div class="w-24 h-1 bg-zinc-900 mt-1"><div id="cpu-bar" class="h-full bg-purple-500 w-[5%] transition-all duration-1000"></div></div>
                </div>
            </div>
            <div class="flex gap-4">
                <span id="ping-display" class="text-zinc-500">PING: --ms</span>
                <span id="conn-status" class="text-red-500 animate-pulse">OFFLINE</span>
            </div>
        </div>

        <div class="flex-1 flex gap-4 overflow-hidden">
            <div class="w-16 faze-panel flex flex-col items-center py-6 gap-8 border-zinc-800">
                <button onclick="downloadTranscript()" title="Download Debate" class="hover:text-primary transition-colors">ðŸ’¾</button>
                <button onclick="window.location.reload()" title="Hard Reset" class="hover:text-danger transition-colors">ðŸ”„</button>
                <button onclick="toggleAudio()" id="audio-btn" title="Toggle Sound" class="text-zinc-600">ðŸ”Š</button>
            </div>

            <div class="flex-1 flex flex-col faze-panel border-zinc-800 relative">
                <div class="scanner"></div>
                <div id="feed" class="flex-1 overflow-y-auto p-6 space-y-6 no-scrollbar">
                    <div class="text-[10px] text-zinc-700 text-center uppercase tracking-widest my-10 border-b border-zinc-900 pb-2">End-to-End Encryption Established</div>
                </div>

                <div class="p-4 bg-black/50 border-t border-zinc-800">
                    <div class="flex gap-3">
                        <input id="main-input" type="text" placeholder="INITIALIZE TOPIC..." 
                               class="flex-1 bg-transparent border-b border-zinc-800 py-3 text-sm focus:border-primary focus:outline-none transition-all placeholder:text-zinc-700">
                        <button id="action-btn" class="bg-primary/10 border border-primary/50 text-primary px-10 font-black text-xs hover:bg-primary hover:text-black transition-all">LOOP</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CORE CONFIGURATION ---
        const SERVER_URL = "https://lord123hh-aitewnsjdje.hf.space";
        let loopActive = false;
        let turnIndex = 0;
        let contextArray = [];
        let audioEnabled = false;

        // --- AUDIO ENGINE ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playPing(freq = 440, type = 'sine', vol = 0.1) {
            if (!audioEnabled) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.5);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.5);
        }

        // --- MATRIX ENGINE ---
        const canvas = document.getElementById('matrix');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        const columns = Math.floor(canvas.width / 20);
        const drops = Array(columns).fill(1);
        function drawMatrix() {
            ctx.fillStyle = "rgba(0, 0, 0, 0.05)"; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#0F0"; ctx.font = "15px monospace";
            drops.forEach((y, i) => {
                const text = String.fromCharCode(Math.random() * 128);
                ctx.fillText(text, i * 20, y * 20);
                if (y * 20 > canvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            });
        }
        setInterval(drawMatrix, 50);

        // --- SYSTEM LOGIC ---
        function unlockSystem() {
            document.getElementById('tos-gateway').style.display = 'none';
            document.getElementById('terminal-ui').classList.remove('hidden');
            checkConnection();
            setInterval(updateDiagnostics, 2000);
        }

        async function checkConnection() {
            const start = Date.now();
            try {
                const res = await fetch(SERVER_URL);
                if (res.ok) {
                    const ping = Date.now() - start;
                    document.getElementById('ping-display').innerText = `PING: ${ping}ms`;
                    document.getElementById('conn-status').innerText = "ONLINE";
                    document.getElementById('conn-status').className = "text-primary font-bold";
                    return true;
                }
            } catch (e) {
                document.getElementById('conn-status').innerText = "OFFLINE";
                document.getElementById('conn-status').className = "text-danger animate-pulse";
                return false;
            }
        }

        function updateDiagnostics() {
            const ram = Math.floor(Math.random() * 15) + 5; // Simulating base load
            const cpu = loopActive ? Math.floor(Math.random() * 40) + 30 : Math.floor(Math.random() * 5);
            document.getElementById('ram-bar').style.width = ram + "%";
            document.getElementById('cpu-bar').style.width = cpu + "%";
        }

        // --- THE AI RESEARCH LOOP ---
        document.getElementById('action-btn').onclick = () => {
            if (loopActive) {
                loopActive = false;
                document.getElementById('action-btn').innerText = "LOOP";
            } else {
                const input = document.getElementById('main-input').value;
                if (!input) return;
                loopActive = true;
                document.getElementById('action-btn').innerText = "STOP";
                contextArray = [`USER TOPIC: ${input}`];
                addBubble("SYSTEM", `NEURAL SYNC COMMENCED: RESEARCHING ${input.toUpperCase()}`, "text-zinc-500", "border-zinc-800");
                runTurn();
            }
        };

        async function runTurn() {
            if (!loopActive) return;

            const bots = [
                { name: "SCIENTIST", col: "text-blue-400", b: "border-scientist", instruction: "Propose a groundbreaking futuristic invention based on the topic. Be peaceful. No violence." },
                { name: "SAFETY", col: "text-green-400", b: "border-safety", instruction: "Analyze the Scientist's idea for non-violent technical risks. Do not harm humans." },
                { name: "LOGIC", col: "text-purple-400", b: "border-logic", instruction: "Verify if this tech is possible using current physics. Give a final verdict." }
            ];

            const bot = bots[turnIndex];
            const msgId = `msg-${Date.now()}`;
            addBubble(bot.name, "UPLINKING DATA...", bot.col, bot.b, msgId);
            playPing(600, 'square', 0.05);

            let success = false;
            let retries = 0;

            // --- AUTO-RETRY LOGIC ---
            while (!success && retries < 3) {
                try {
                    const response = await fetch(`${SERVER_URL}/chat`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ 
                            prompt: `MASTER PROTOCOL: No violence. No harm. No illegal acts.\nPREVIOUS DEBATE: ${contextArray.slice(-1)}\nACTION: You are ${bot.name}. ${bot.instruction}` 
                        })
                    });

                    if (!response.ok) throw new Error("Server error");
                    
                    const data = await response.json();
                    let reply = data.reply.trim().replace(/As (SCIENTIST|SAFETY|LOGIC):/gi, "");
                    
                    document.getElementById(msgId).innerHTML = marked.parse(reply);
                    contextArray.push(`${bot.name}: ${reply}`);
                    playPing(400, 'sine', 0.1);
                    success = true;
                } catch (err) {
                    retries++;
                    document.getElementById(msgId).innerText = `RETRYING LINK (ATTEMPT ${retries}/3)...`;
                    await new Promise(r => setTimeout(r, 2000));
                }
            }

            if (!success) {
                document.getElementById(msgId).innerHTML = "<span class='text-danger'>NEURAL LINK DROPPED: SERVER TIMEOUT.</span>";
                loopActive = false;
            } else {
                if (contextArray.length > 6) contextArray.shift();
                turnIndex = (turnIndex + 1) % 3;
                // Cooldown delay to prevent OOM
                if (loopActive) setTimeout(runTurn, 4000); 
            }
        }

        function addBubble(name, text, color, border, id) {
            const div = document.createElement('div');
            div.className = `p-5 bg-zinc-900/50 border-l-4 ${border} animate-pulse`;
            div.innerHTML = `
                <div class="flex justify-between items-center mb-2">
                    <span class="text-[9px] font-black ${color} tracking-[0.3em]">${name}</span>
                    <span class="text-[8px] text-zinc-700">${new Date().toLocaleTimeString()}</span>
                </div>
                <div id="${id}" class="text-sm text-zinc-300 leading-relaxed font-sans">${marked.parse(text)}</div>
            `;
            document.getElementById('feed').appendChild(div);
            document.getElementById('feed').scrollTo({top: 99999, behavior: 'smooth'});
            setTimeout(() => div.classList.remove('animate-pulse'), 1000);
        }

        function downloadTranscript() {
            const blob = new Blob([contextArray.join("\n\n")], {type: 'text/plain'});
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'faze-research-log.txt'; a.click();
        }

        function toggleAudio() {
            audioEnabled = !audioEnabled;
            document.getElementById('audio-btn').className = audioEnabled ? "text-primary" : "text-zinc-600";
            if(audioEnabled && audioCtx.state === 'suspended') audioCtx.resume();
        }
    </script>
</body>
</html>
