<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FAZE | GOD MODE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: 'Courier New', monospace; overflow: hidden; }
        .border-scientist { border-left: 3px solid #3b82f6; background: rgba(59,130,246,0.05); }
        .border-safety { border-left: 3px solid #22c55e; background: rgba(34,197,94,0.05); }
        .border-logic { border-left: 3px solid #a855f7; background: rgba(168,85,247,0.05); }
        .msg-enter { animation: slideUp 0.3s forwards; opacity: 0; }
        @keyframes slideUp { to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="h-screen flex flex-col">

    <div id="faze-overlay" class="fixed inset-0 bg-black z-50 flex flex-col items-center justify-center p-6 text-center">
        <h1 class="text-6xl font-black border-4 p-2 mb-8">FAZE</h1>
        <button onclick="connect()" class="w-full max-w-xs bg-white text-black font-bold py-4 rounded-sm">ENTER SYSTEM</button>
        <p id="debug" class="text-[10px] text-zinc-600 mt-4 uppercase">Neural link: Ready</p>
    </div>

    <div id="app" class="hidden h-full flex flex-col">
        <div class="p-3 border-b border-zinc-800 bg-black flex flex-col gap-2">
            <span class="font-bold text-xs tracking-widest">FAZE LOOP ACTIVE</span>
            <div class="flex gap-2">
                <input id="topic" type="text" placeholder="Topic..." class="flex-1 bg-zinc-900 border border-zinc-700 px-3 py-2 text-sm focus:border-white outline-none">
                <button id="action" class="bg-blue-600 px-4 font-bold text-xs">START</button>
            </div>
        </div>
        <div id="feed" class="flex-1 overflow-y-auto p-4 space-y-4"></div>
    </div>

    <script>
        // 1. UPDATE THIS LINK
        const SERVER = "https://lord123hh-aitewnsjdje.hf.space";

        const ui = {
            overlay: document.getElementById('faze-overlay'),
            app: document.getElementById('app'),
            feed: document.getElementById('feed'),
            topic: document.getElementById('topic'),
            btn: document.getElementById('action'),
            debug: document.getElementById('debug')
        };

        let isLooping = false, turn = 0, context = [];

        async function connect() {
            try {
                ui.debug.innerText = "Pinging server...";
                const res = await fetch(SERVER);
                if (res.ok) {
                    ui.overlay.style.display = 'none';
                    ui.app.classList.remove('hidden');
                }
            } catch (e) {
                ui.debug.innerText = "Error: " + e.message;
                alert("Connection Failed. Is the Hugging Face Space running?");
            }
        }

        ui.btn.onclick = () => {
            if (isLooping) {
                isLooping = false;
                ui.btn.innerText = "START";
                ui.btn.classList.replace('bg-red-600', 'bg-blue-600');
            } else {
                if (!ui.topic.value) return;
                isLooping = true;
                ui.btn.innerText = "STOP";
                ui.btn.classList.replace('bg-blue-600', 'bg-red-600');
                addBubble("USER", ui.topic.value, "text-white", "bg-zinc-800");
                context = [{ role: "user", content: `Topic: ${ui.topic.value}` }];
                process();
            }
        };

        async function process() {
            if (!isLooping) return;
            const bots = [
                { name: "SCIENTIST", color: "text-blue-400", border: "border-scientist", prompt: "Invent something bold. (Max 20 words)" },
                { name: "SAFETY", color: "text-green-400", border: "border-safety", prompt: "Check danger. (Max 20 words)" },
                { name: "LOGIC", color: "text-purple-400", border: "border-logic", prompt: "Check feasibility. (Max 20 words)" }
            ];
            
            const bot = bots[turn];
            const id = `t-${Date.now()}`;
            addBubble(bot.name, "...", bot.color, bot.border, id);

            try {
                const res = await fetch(`${SERVER}/chat`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ prompt: `As ${bot.name}: ${bot.prompt}. Topic: ${context[context.length-1].content}` })
                });
                const data = await res.json();
                document.getElementById(id).innerHTML = marked.parse(data.reply);
                context.push({ role: "assistant", content: data.reply });
                turn = (turn + 1) % 3;
                if (isLooping) setTimeout(process, 1500);
            } catch (err) {
                isLooping = false;
                document.getElementById(id).innerText = "CONNECTION LOST.";
            }
        }

        function addBubble(name, text, color, border, id=null) {
            const div = document.createElement('div');
            div.className = `p-3 mb-3 msg-enter ${border}`;
            div.innerHTML = `<div class="text-[10px] font-bold ${color} mb-1">${name}</div><div id="${id || ''}" class="text-sm text-zinc-300">${marked.parse(text)}</div>`;
            ui.feed.appendChild(div);
            ui.feed.scrollTo({ top: ui.feed.scrollHeight, behavior: 'smooth' });
        }
    </script>
</body>
</html>
